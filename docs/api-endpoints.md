# API-эндпоинты Deadline Mate

В данном документе описаны все API-эндпоинты проекта Deadline Mate, организованные по функциональным модулям.

## Формат ответов API

Все API-эндпоинты возвращают ответы в формате JSON со следующей общей структурой:

### Успешный ответ:
```json
{
  "success": true,
  "data": { ... },  // Варьируется в зависимости от запроса
  "message": "..." // Опционально
}
```

### Ответ с ошибкой:
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Описание ошибки"
  },
  "errors": [ ... ] // Опционально, для валидации форм
}
```

## 1. Аутентификация и управление пользователями

Базовый URL: `/api/auth/`

| Метод | Эндпоинт               | Описание                                      | Параметры запроса                                                      | Права доступа           |
|-------|------------------------|-----------------------------------------------|-----------------------------------------------------------------------|--------------------------|
| POST  | `/login/`              | Авторизация пользователя                      | `username`, `password`                                                 | Любой                   |
| POST  | `/token/`              | Получение JWT-токена                          | `username`, `password`                                                 | Любой                   |
| POST  | `/token/refresh/`      | Обновление JWT-токена                         | `refresh` (refresh token)                                              | Аутентифицированный     |
| POST  | `/register/`           | Регистрация нового пользователя               | `username`, `email`, `password`, `password_confirm`, `role`, данные профиля | Любой                   |
| GET   | `/me/`                 | Получение данных текущего пользователя        | -                                                                     | Аутентифицированный     |
| PUT   | `/me/`                 | Обновление данных текущего пользователя       | Обновляемые поля пользователя                                         | Аутентифицированный     |
| PATCH | `/me/password/`        | Изменение пароля                              | `old_password`, `new_password`, `new_password_confirm`                | Аутентифицированный     |
| POST  | `/password-reset/`     | Запрос на сброс пароля                        | `email`                                                               | Любой                   |
| POST  | `/password-reset/confirm/` | Подтверждение сброса пароля               | `token`, `uid`, `new_password`, `new_password_confirm`                | Любой                   |
| POST  | `/logout/`             | Выход из системы (инвалидация токена)         | -                                                                     | Аутентифицированный     |

## 2. Управление группами

Базовый URL: `/api/groups/`

| Метод   | Эндпоинт                | Описание                                      | Параметры запроса                             | Права доступа                |
|---------|-------------------------|-----------------------------------------------|--------------------------------------------|-------------------------------|
| GET     | `/`                     | Получение списка групп пользователя           | Параметры фильтрации и сортировки           | Аутентифицированный          |
| POST    | `/`                     | Создание новой группы                         | `name`, `description`, `is_active`          | Преподаватель                |
| GET     | `/{id}/`                | Получение информации о группе                 | -                                          | Участник/преподаватель группы |
| PUT     | `/{id}/`                | Обновление группы                             | `name`, `description`, `is_active`          | Преподаватель группы         |
| DELETE  | `/{id}/`                | Удаление группы                               | -                                          | Создатель группы             |
| GET     | `/{id}/members/`        | Получение списка участников группы            | Параметры фильтрации и сортировки           | Участник/преподаватель группы |
| POST    | `/{id}/members/`        | Добавление студента в группу                  | `student_id`, `role`                        | Преподаватель группы         |
| DELETE  | `/{id}/members/{member_id}/` | Удаление студента из группы              | -                                          | Преподаватель группы         |
| PATCH   | `/{id}/members/{member_id}/` | Изменение роли студента в группе         | `role`                                      | Преподаватель группы         |
| GET     | `/{id}/teachers/`       | Получение списка преподавателей группы        | -                                          | Участник/преподаватель группы |
| POST    | `/{id}/teachers/`       | Добавление преподавателя в группу             | `teacher_id`                                | Преподаватель группы         |
| DELETE  | `/{id}/teachers/{teacher_id}/` | Удаление преподавателя из группы       | -                                          | Создатель группы             |
| POST    | `/join/`                | Присоединение к группе по коду                | `code`                                      | Студент                      |
| POST    | `/{id}/join-as-teacher/`| Присоединение к группе в качестве преподавателя | -                                         | Преподаватель               |

## 3. Управление заданиями

Базовый URL: `/api/assignments/`

| Метод   | Эндпоинт                    | Описание                                      | Параметры запроса                                                   | Права доступа                |
|---------|-----------------------------|--------------------------------------------|----------------------------------------------------------------|-------------------------------|
| GET     | `/`                         | Получение списка заданий                     | Параметры фильтрации и сортировки                                 | Аутентифицированный          |
| POST    | `/`                         | Создание нового задания                      | `title`, `description`, `deadline`, `max_points`, `status`, и др. | Преподаватель                |
| GET     | `/{id}/`                    | Получение информации о задании               | -                                                              | Автор или назначен задание    |
| PUT     | `/{id}/`                    | Обновление задания                           | Поля задания для обновления                                      | Автор задания                |
| DELETE  | `/{id}/`                    | Удаление задания                             | -                                                              | Автор задания                |
| POST    | `/{id}/publish/`            | Публикация задания (изменение статуса)       | -                                                              | Автор задания                |
| POST    | `/{id}/archive/`            | Архивация задания (изменение статуса)        | -                                                              | Автор задания                |
| GET     | `/{id}/attachments/`        | Получение вложений задания                   | -                                                              | Автор или назначен задание    |
| POST    | `/{id}/attachments/`        | Добавление вложения к заданию                | `file`, `description`                                           | Автор задания                |
| DELETE  | `/{id}/attachments/{att_id}/` | Удаление вложения                         | -                                                              | Автор задания                |
| POST    | `/{id}/assign/`             | Назначение задания группе                    | `group_id`, `custom_deadline` (опционально)                     | Автор задания или преподаватель |
| DELETE  | `/{id}/assign/{group_id}/`  | Отмена назначения группе                     | -                                                              | Автор задания или преподаватель |
| GET     | `/{id}/groups/`             | Получение групп, которым назначено задание   | -                                                              | Автор задания или преподаватель |

## 4. Управление ответами на задания (submissions)

Базовый URL: `/api/submissions/`

| Метод   | Эндпоинт                    | Описание                                      | Параметры запроса                                   | Права доступа                |
|---------|-----------------------------|--------------------------------------------|--------------------------------------------------|-------------------------------|
| GET     | `/`                         | Получение списка своих ответов (для студента) или ответов на задания (для преподавателя) | Параметры фильтрации и сортировки | Аутентифицированный          |
| POST    | `/`                         | Отправка ответа на задание                   | `assignment_id`, `comment`, вложения              | Студент                      |
| GET     | `/{id}/`                    | Получение информации об ответе               | -                                                | Автор ответа или преподаватель |
| PUT     | `/{id}/`                    | Обновление ответа (до проверки)              | `comment`, вложения                               | Автор ответа                 |
| GET     | `/{id}/attachments/`        | Получение вложений ответа                    | -                                                | Автор ответа или преподаватель |
| POST    | `/{id}/attachments/`        | Добавление вложения к ответу                 | `file`, `description`                            | Автор ответа                 |
| DELETE  | `/{id}/attachments/{att_id}/` | Удаление вложения ответа                  | -                                                | Автор ответа                 |
| GET     | `/assignment/{assignment_id}/` | Получение всех ответов на задание         | Параметры фильтрации и сортировки                 | Преподаватель                |
| POST    | `/{id}/grade/`              | Оценивание ответа                           | `points`, `feedback`, `status`                   | Преподаватель                |
| POST    | `/{id}/return/`             | Возврат ответа на доработку                 | `feedback`                                       | Преподаватель                |

## 5. Прогресс и аналитика

Базовый URL: `/api/progress/` и `/api/analytics/`

| Метод   | Эндпоинт                          | Описание                                         | Параметры запроса              | Права доступа                |
|---------|-----------------------------------|------------------------------------------------|-------------------------------|-------------------------------|
| GET     | `/progress/student/`              | Получение прогресса студента                     | `student_id` (опционально)    | Студент или преподаватель     |
| GET     | `/progress/student/{student_id}/` | Получение прогресса конкретного студента         | -                             | Преподаватель                |
| GET     | `/progress/group/{group_id}/`     | Получение прогресса группы                       | -                             | Преподаватель группы         |
| GET     | `/progress/assignment/{id}/`      | Получение прогресса по заданию                   | -                             | Автор задания или преподаватель |
| GET     | `/analytics/student/performance/` | Аналитика успеваемости студента                  | Временной интервал, фильтры    | Студент или преподаватель     |
| GET     | `/analytics/teacher/overview/`    | Обзор аналитики для преподавателя                | Временной интервал, фильтры    | Преподаватель                |
| GET     | `/analytics/group/{group_id}/`    | Аналитика по группе                             | Временной интервал, фильтры    | Преподаватель группы         |
| GET     | `/analytics/assignments/summary/` | Сводная аналитика по заданиям                    | Временной интервал, фильтры    | Преподаватель                |

## 6. Уведомления

Базовый URL: `/api/notifications/`

| Метод   | Эндпоинт              | Описание                                      | Параметры запроса                | Права доступа          |
|---------|----------------------|--------------------------------------------|----------------------------------|-------------------------|
| GET     | `/`                  | Получение списка уведомлений пользователя      | Параметры фильтрации, пагинация  | Аутентифицированный    |
| GET     | `/unread/`           | Получение списка непрочитанных уведомлений     | -                               | Аутентифицированный    |
| POST    | `/{id}/read/`        | Отметить уведомление как прочитанное           | -                               | Получатель уведомления  |
| POST    | `/read-all/`         | Отметить все уведомления как прочитанные       | -                               | Аутентифицированный    |
| GET     | `/settings/`         | Получение настроек уведомлений                 | -                               | Аутентифицированный    |
| PUT     | `/settings/`         | Обновление настроек уведомлений                | Настройки по типам уведомлений   | Аутентифицированный    |

## 7. Служебные эндпоинты

| Метод | Эндпоинт               | Описание                                      | Параметры запроса   | Права доступа        |
|-------|------------------------|-----------------------------------------------|-------------------|-----------------------|
| GET   | `/api/status`          | Проверка статуса API                          | -                 | Любой                |
| GET   | `/api/docs/swagger/`   | Swagger документация API                      | -                 | Любой                |
| GET   | `/api/docs/redoc/`     | ReDoc документация API                        | -                 | Любой                |

## Параметры фильтрации и сортировки

Большинство списочных эндпоинтов поддерживают следующие общие параметры:

- `page`: номер страницы для пагинации
- `page_size`: количество элементов на странице
- `search`: поисковый запрос по текстовым полям
- `ordering`: поле для сортировки (префикс `-` для сортировки по убыванию)
- `created_after`/`created_before`: фильтрация по дате создания
- `updated_after`/`updated_before`: фильтрация по дате обновления

Дополнительные параметры специфичны для каждого эндпоинта и могут включать:
- Для заданий: `status`, `deadline_before`, `deadline_after`, `is_deadline_expired`
- Для групп: `is_active`, `created_by`
- Для ответов: `status`, `submitted_after`, `submitted_before`, `graded`

## Коды ошибок

| Код ошибки                   | Описание                                         | HTTP-статус |
|------------------------------|--------------------------------------------------|-------------|
| `AUTHENTICATION_FAILED`      | Ошибка аутентификации                            | 401         |
| `PERMISSION_DENIED`          | Отказ в доступе                                  | 403         |
| `RESOURCE_NOT_FOUND`         | Ресурс не найден                                 | 404         |
| `VALIDATION_ERROR`           | Ошибка валидации данных                          | 400         |
| `DEADLINE_EXPIRED`           | Срок выполнения задания истек                    | 400         |
| `ALREADY_SUBMITTED`          | Ответ уже отправлен                              | 400         |
| `INVALID_STATUS_TRANSITION`  | Недопустимый переход между статусами             | 400         |
| `RESOURCE_ALREADY_EXISTS`    | Ресурс уже существует (дубликат)                 | 409         |
| `INTERNAL_SERVER_ERROR`      | Внутренняя ошибка сервера                        | 500         | 